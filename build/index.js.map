{"version":3,"sources":["webpack://CrossOriginStorage/webpack/universalModuleDefinition","webpack://CrossOriginStorage/webpack/bootstrap","webpack://CrossOriginStorage/./src/lib/enums/methods.enum.ts","webpack://CrossOriginStorage/./src/lib/enums/status.enum.ts","webpack://CrossOriginStorage/webpack/runtime/define property getters","webpack://CrossOriginStorage/webpack/runtime/hasOwnProperty shorthand","webpack://CrossOriginStorage/webpack/runtime/make namespace object","webpack://CrossOriginStorage/./src/lib/utils.ts","webpack://CrossOriginStorage/./src/lib/cross-origin-storage-host.ts","webpack://CrossOriginStorage/./src/lib/cross-origin-storage-guest.ts"],"names":["root","factory","exports","module","define","amd","self","MethodsEnum","StatusEnum","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","isValidOrigin","origin","whitelist","find","link","includes","makeMessage","requestId","identifier","method","data","id","getData","$event","JSON","parse","err","config","iframeUrl","excludes","initCallback","this","isInit","Error","init","window","addEventListener","receiveMessage","bind","wrapper","document","createElement","innerHTML","options","body","appendChild","iframe","getElementById","READY","isReady","executeCallback","requests","attachEvents","createIframe","callback","payload","SET","keys","sessionStorage","forEach","getItem","contentWindow","postMessage","stringify","CLEAR","onmessage","currentUrl","location","setItem","parent","onInitFinished"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CrossOriginStorage\"] = factory();\n\telse\n\t\troot[\"CrossOriginStorage\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","export enum MethodsEnum {\n  SET = \"set\",\n  CLEAR = \"clear\",\n}\n","export enum StatusEnum {\n  READY = \"onReady\",\n}\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { Message } from \"./interfaces/message.interface\";\n\nexport function isSameOrigin(currentUrl: string, origin: string): boolean {\n  return currentUrl === origin;\n}\n\nexport function isValidOrigin(origin: string, whitelist: string[]): boolean {\n  return whitelist.find((link) => link.includes(origin)) ? true : false;\n}\n\nexport function makeMessage(\n  requestId: number,\n  identifier: string,\n  method: string,\n  data: any\n): Message {\n  return {\n    id: requestId,\n    identifier: identifier,\n    method: method,\n    data: data,\n  };\n}\n\nexport function getData($event: any): Message {\n  let data;\n\n  try {\n    data = JSON.parse($event.data);\n  } catch (err) {}\n\n  return data;\n}\n","import { isValidOrigin, makeMessage, getData } from \"./utils\";\nimport { MethodsEnum } from \"./enums/methods.enum\";\nimport { StatusEnum } from \"./enums/status.enum\";\nimport { HostConfig } from \"./interfaces/host-config.interface\";\n\nclass CrossOriginStorageHost {\n  iframe: any;\n  isInit = false;\n  isReady = false;\n  requestId = -1;\n  requests = {};\n  options: HostConfig = {\n    iframeUrl: \"\",\n    identifier: \"\",\n    whitelist: [],\n    excludes: [],\n    initCallback: function () {},\n  };\n\n  constructor(config: HostConfig) {\n    if (!config.hasOwnProperty(\"iframeUrl\") || this.isInit) {\n      throw new Error(\"Error before initiating\");\n    }\n\n    this.init(config);\n  }\n\n  private attachEvents() {\n    if (window.addEventListener) {\n      window.addEventListener(\"message\", this.receiveMessage.bind(this), false);\n    } else {\n      window[\"attachEvent\"](\"onmessage\", this.receiveMessage.bind(this));\n    }\n  }\n\n  private createIframe(identifier: string): void {\n    const wrapper = document.createElement(\"div\");\n    wrapper.innerHTML = `<iframe id=\"${identifier}\" src=\"${this.options.iframeUrl}\" style=\"display: none;\"></iframe>`;\n    document.body.appendChild(wrapper);\n    this.iframe = document.getElementById(identifier);\n  }\n\n  private receiveMessage($event: any): void {\n    const data = getData($event);\n\n    if (data && isValidOrigin($event.origin, this.options.whitelist)) {\n      if (data.method !== StatusEnum.READY || this.isReady) {\n        return this.executeCallback(data);\n      }\n\n      this.isReady = true;\n      this.options.initCallback();\n    }\n  }\n\n  private executeCallback(data: any): void {\n    if (this.requests[data.id]) {\n      this.requests[data.id](data);\n      delete this.requests[data.id];\n    }\n  }\n\n  init(config: HostConfig): void {\n    this.isInit = true;\n    this.options = config;\n    const { identifier } = config;\n\n    this.attachEvents();\n    this.createIframe(identifier);\n  }\n\n  clone(callback: any): void {\n    this.requestId++;\n    this.requests[this.requestId] = callback;\n    var payload = makeMessage(\n      this.requestId,\n      this.options.identifier,\n      MethodsEnum.SET,\n      {}\n    );\n\n    Object.keys(window.sessionStorage).forEach((key) => {\n      if (this.options.excludes && this.options.excludes.includes(key)) return;\n      payload.data[key] = window.sessionStorage.getItem(key);\n    });\n\n    this.iframe.contentWindow.postMessage(JSON.stringify(payload), \"*\");\n  }\n\n  clear(callback: any): void {\n    this.requestId++;\n    this.requests[this.requestId] = callback;\n    const payload = makeMessage(\n      this.requestId,\n      this.options.identifier,\n      MethodsEnum.CLEAR,\n      null\n    );\n    this.iframe.contentWindow.postMessage(JSON.stringify(payload), \"*\");\n  }\n}\n\nexport default CrossOriginStorageHost;\n","import { isValidOrigin, isSameOrigin, makeMessage, getData } from \"./utils\";\nimport { MethodsEnum } from \"./enums/methods.enum\";\nimport { StatusEnum } from \"./enums/status.enum\";\nimport { GuestConfig } from \"./interfaces/guest-config.interface\";\n\nclass CrossOriginStorageGuest {\n  isInit = false;\n  requestId = -1;\n  options: GuestConfig = {\n    identifier: \"\",\n    whitelist: [],\n  };\n\n  constructor(config: GuestConfig) {\n    if (!config.hasOwnProperty(\"identifier\") || this.isInit) {\n      throw new Error(\"Error before initiating\");\n    }\n\n    this.init(config);\n  }\n\n  private attachEvents() {\n    window.onmessage = ($event: any) => {\n      if (isSameOrigin(window.location.origin, $event.origin)) {\n        return;\n      }\n\n      if (!isValidOrigin($event.origin, this.options.whitelist)) {\n        throw new Error(\"Forbidden origin\");\n      }\n\n      const data = getData($event);\n\n      if (data) {\n        const payload = makeMessage(\n          this.requestId,\n          this.options.identifier,\n          MethodsEnum.SET,\n          data.data\n        );\n\n        if (data.method === MethodsEnum.SET) {\n          Object.keys(data.data).forEach(function (key) {\n            window.sessionStorage.setItem(key, data.data[key]);\n          });\n\n          window.parent.postMessage(JSON.stringify(payload), \"*\");\n        }\n      }\n    };\n  }\n\n  private onInitFinished(identifier: string): void {\n    this.requestId++;\n    const data = makeMessage(\n      this.requestId,\n      identifier,\n      StatusEnum.READY,\n      null\n    );\n    window.parent.postMessage(JSON.stringify(data), \"*\");\n  }\n\n  init(config: GuestConfig): void {\n    this.isInit = true;\n    this.options = config;\n    const { identifier } = config;\n\n    this.attachEvents();\n    this.onInitFinished(identifier);\n  }\n}\n\nexport default CrossOriginStorageGuest;\n"],"sourceRoot":""}